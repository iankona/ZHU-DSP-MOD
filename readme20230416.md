<div align="center" style="font-size: 42px; font-weight:bold;">戴森球计划Mod</div>
---



<div align="left" style="font-size: 32px;font-weight:bold;">一、戴森球计划Mod
    <a style="font-size: 24px;">What is this Script? </a></div> 
<div align="right" style="font-size: 18px;font-weight:bold;">日期：
    <a style="font-size: 18px;">2023年4月16日 </a></div> 

这次写的mod主要是ZHU小矿机采集整个矿簇.dll、ZHU荒漠星添加石油.dll、ZHU轨道采集器立即建造.dll、ZHU更高功率能量枢纽.dll四个mod，需要配合ZHU取物范围.dll、BetterUniverseInfo.dll和FastTravelEnabler.dll使用，从而实现保护星球玩法，开局跳出母星，不破坏星球一草一木（枯木暂时不算），到隔壁荒漠星发展，有兴趣的可以尝试下。把想要的dll直接放到BepInEX的plugins文件夹里就行，安装mod可以看[宵夜97](https://space.bilibili.com/1306433)’s  [【教程】Unity游戏的Mod模组安装教程](https://www.bilibili.com/video/BV1Vf4y1p78U)教程。

链接：https://pan.baidu.com/s/1Lk5stv2UWtoeeb9CvGn6wA?pwd=46x4 提取码：46x4



- ZHU轨道采集器立即建造.dll

  

  ​	功能与ZHUInstantBuild.dll相同，并将范围限定在轨道采集器，对其他建筑不起作用。ZHU轨道采集器立即建造.dll与ZHUInstantBuild.dll冲突，2者只能选用1个dll放到BepInEX的plugins文件夹里，不能同时放这2个dll。原因是这2个dll同时修改了同一个函数。

  ​	写这个的原因是我飞行1次把气态星球采集器建好，需要20分钟，用了这个mod后大概可以几分钟飞行一圈球就建好了，节省时间。

  ​	背包有物品时，会消耗物品立即建造，没物品的时候也会立即建造。小飞机起飞后，由于已经建造完会转向飞回背包，会少量耗电。

  

- ZHU小矿机采集整个矿簇.dll

  

  ​	功能是小采矿机正常放，但它会采集整个矿簇（1个矿组里有多条矿脉）相比于PlanetwideMining和星球矿机mod全球采矿，这个只采集当前矿组，轻量化修改。

  ​	会折腾这个的原因是楼主经常重开新档，被早期的开局采矿折腾的不行。配合ZHU取物范围.dll可以星球视图操作全球建筑设备，不用浪费时间跑来跑去，可以平滑经过前期阶段。而且荒漠星不是出生星球，铁矿铜矿，不一定都在落点附近。前期腿短，工业园区又要来回跑，跑来跑去浪费时间不说，作为1个探索机甲，没有携带信号中继器就有点理解不能。

  ​	最早的思路是2倍采矿思路，会导致2倍耗电。原先75%供电可以采24个/矿脉，修改后18%供电只能采集14个/矿脉，而且前期电量不足，还会影响到大矿机，于是放弃这个思路。

  ​	前期的黄带带宽只有6个/s，所以我的思路很自然的想到扩大采矿机的采矿范围可以满黄带，想要扩大小采矿机选择范围，找了很久，只找到常量没找到使用的函数，修改常量成功后，没效果，也放弃了这个思路。

  ​	中间一段时间转去查看添加星球mod的添加矿脉算法，有找到，但需要汇编层次，遂放弃，转而查看戴森球计划原始函数代码，完全看不懂算法，但看懂了出生星球出生点添加铜矿和铁矿的几行简单代码，于是瞬间知道了如何别扭的添加矿脉，把整个函数复制出来，在禁用原函数，按照出生点添加铜铁的方式，成功添加了新矿脉。这个过程接触到了矿脉矿组的数据，把我思路导向了小采矿机采集整个矿组。中间有一些波折，问题和扩大选择范围差不多，完全找不到扩大选择的函数，推测为gpu代码，不是cpu代码。后面为了弄清楚添加矿脉的算法过程，直到看到了存档读取函数，瞬间打开了思路，迅速抛开了原函数是怎么写的，而是从数据结构出发，不去管选择渲染这些，很自然的完成小采矿机采集整个矿簇功能。

  ​	折腾小采矿机的根本原因是前期好几个采矿机在那边扭，我觉得有些难受，所以准备减少采矿机用量，并想看看前期围绕矿点建立工业区的图景是怎么样的。这个mod可以实现只要碰到矿组中任意一个矿脉就可以采集整个矿组并满黄带输出，这让小采矿机的整齐排列成为可能，至少会比现在好些。实际上我更想要的是定点悬浮在矿组或矿脉上采矿。

  

- ZHU荒漠星添加石油.dll

  

  ​	mod效果，清除所有地中海，海洋丛林等Ocean星球矿物，并在荒漠、隔壁、盐滩等Desert星球添加石油和煤炭。水世界石油没有清除成功，可能是走的奇珍添加矿物路径，我没找到函数。

  ​	很早之前就简单复制原函数并禁用原函数，实现了添加矿物和星球不生成矿脉，缺点是出生星球不见了登陆仓，以及降落过程画面凌乱旋转。所以一直在思考新的方式。

  ​	中间切换到数据结构视角，完成小采矿机采集矿组功能后，着手了第2版的开发，就是本dll。我把功能限定在清除Ocean星球矿物和Desert星球添加石油和煤炭，实现保留了登陆仓，这是对应我很早以前的思考，保护星球的玩法，后面是往Ocean星球添加兽耳lili，这个功能只能期待有大佬开发了。戴森球虽然是工厂游戏，但戴森球计划舒服的游戏画面，很明显拥有广阔的奇观玩法。

  ​	开发过程，到现在我都没明白戴森球制作组的矿脉生成是怎么实现的，虽然我知道关键点是Cos()和Sin()数学函数，但过程始终理不懂。所以，我从数据结构视角出发，写了另一个矿脉生成方式，只能说很像，大差不差。

  ​	选择在荒漠星，而不是冻土星添加矿物，是因为冻土星对建筑建设很不友好。每个荒漠星星球的石油在50到100个/s,，煤炭矿脉100多个无限矿。应该能补上缺少的矿物。铁铜石头矿等普通矿物，我就没理会了。整个星区的奇珍矿物没有任何变化。

  ​	需要需要配合BetterUniverseInfo.dll和FastTravelEnabler.dll使用。BetterUniverseInfo用于在选种子界面查看出生星系是否有荒漠星，FastTravelEnabler用于右键跳出出生星球，到本星系隔壁星球发展。前期查看星际矿物功能没解锁，跳出出生星系去其他星系找星系是很浪费时间的，当然好奇去看其他星系也是OK的。mod下载地址：https://dsp.thunderstore.io/

  

- ZHU更高功率能量枢纽.dll

  

  ​	功率315MW（对应星际塔300MW），能量10.26GJ，对比的黑棒72MW，7.20GJ，1W=1J/s。没有涉及发电量的改动，只改动了能量运输。

  ​	这是一个尝试，我在想，戴森球计划如何可以不用理会不感兴趣的东西，可以从太阳能板简单平滑玩到白糖，不用强制其他游戏内容，要求玩家一定要处理这些，等玩家回过头来在看原来的产线，自然而然会想去提升，这样减少玩家改造自己产线的不适感。

  ​	我要再提一次建筑建好后的拖动功能什么时候出来。

  

项目代码主要参考了[LittleSaya](https://github.com/LittleSaya/IndexOutOfRangeDSPMod/tree/master/DSPAddPlanet)’s  [DSPAddPlanet](https://github.com/LittleSaya/IndexOutOfRangeDSPMod/tree/master/DSPAddPlanet)项目、[宵夜97](https://space.bilibili.com/1306433)’s  [【教程】Unity游戏的Mod模组安装教程](https://www.bilibili.com/video/BV1Vf4y1p78U)教程、[【戴森球计划】LDBTool Mod教程](https://www.bilibili.com/video/BV1aN411R7Rr)、[【游戏Mod开发教程】系列教程（Unity）游戏Mod开发教程](https://www.bilibili.com/video/BV1ZY4y1q7gj)和宵夜97游戏mod开发教程专栏文字版（知识点）项目

这些教程靠【戴森球计划】和【mod制作】关键字搜索不出来，原先小白时靠这些关键字搜到了另一位up主的[是小庄庄鸭](https://space.bilibili.com/26024327)’s  戴森球计划Mod制作教学教程。这次能找到宵夜97的教程有点波折，起因是我要修改小矿机采矿范围，发现私有对象和const常量成员修改不了，开始寻找解决方式，搜到AccessTools ，之后找到宵夜97的教程(C#)，私有成员用Traverse.Create(... ...方式修改，常量成员用AccessTools.Field(typeof(PlanetAlgorithm), "planet").GetValue(__instance)；方式修改。这样虽然代码多繁琐，但起作用。减少代码量可以用NStrip.exe把dll的私有成员转公开的成员，在引用生成的dll，这样可以减少一大堆Traverse代码，详见[宵夜97](https://space.bilibili.com/1306433)’s[【戴森球计划】LDBTool Mod教程](https://www.bilibili.com/video/BV1aN411R7Rr)。常量依旧用AccessTools方式修改。





